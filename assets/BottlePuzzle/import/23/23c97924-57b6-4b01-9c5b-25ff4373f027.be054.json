[1,0,0,[["cc.TextAsset",["_name","text"],1]],[[0,0,1,3]],[[0,"README","# BottlePuzzle 副玩法模块\r\n\r\n这是一个基于 Cocos Creator 的水瓶谜题游戏模块，采用**预生成关卡系统**。关卡在开发阶段生成并验证有解，打包后玩家直接加载这套经过验证的关卡。\r\n\r\n## 特性\r\n\r\n- **第一关**：5个瓶子，容量分别为 5、4、3、2、1\r\n- **后续关卡**：3个瓶子（容量固定为10），难度通过液体分配复杂性递增\r\n- **自动验证有解**：使用 BFS 算法验证每个生成的关卡都有解法\r\n- **预生成关卡**：开发时生成关卡文件，打包时随游戏一起发布\r\n- **玩家统一体验**：所有玩家都使用同一套经过验证的关卡\r\n- **游戏机制**：通过点击选择瓶子并倒水，将液体分配到目标容量\r\n- **撤销功能**：支持撤销最近的操作（最多50步）\r\n- **重新开始**：可以重置当前关卡\r\n\r\n## 文件结构\r\n\r\n```\r\nBottlePuzzle/\r\n├── script/\r\n│   ├── config/\r\n│   │   ├── LevelConfig_BP.ts          # 关卡配置（从项目资源加载）\r\n│   │   ├── LevelSolver_BP.ts          # 关卡求解器（验证有解）\r\n│   │   ├── LevelGenerator_BP.ts       # 关卡生成器\r\n│   │   ├── LevelDataMgr_BP.ts         # 关卡数据管理器\r\n│   │   ├── LevelGeneratorTool.ts      # 编辑器生成工具\r\n│   │   └── SpriteConfig_BP.ts         # 精灵资源配置\r\n│   ├── game/\r\n│   │   ├── Bottle_BP.ts              # 瓶子类\r\n│   │   └── BottleMgr_BP.ts           # 瓶子管理器\r\n│   ├── GameManager_BP.ts             # 游戏管理器\r\n│   └── UIManager_BP.ts               # UI管理器\r\n├── data/\r\n│   └── levels/                        # 预生成的关卡文件\r\n│       ├── level_1.json\r\n│       ├── level_2.json\r\n│       └── ...\r\n├── prefab/\r\n│   └── BottlePrefab.prefab           # 瓶子预制体\r\n└── texture/\r\n    └── BottleAtlas.plist/.png        # 瓶子和水的精灵图集\r\n```\r\n│   └── UIManager_BP.ts               # UI管理器\r\n├── data/\r\n│   └── levels/                        # 生成的关卡文件存放目录\r\n│       ├── level_1.js\r\n│       ├── level_2.js\r\n│       └── ...\r\n├── prefab/\r\n│   └── BottlePrefab.prefab           # 瓶子预制体\r\n└── texture/\r\n    └── BottleAtlas.plist/.png        # 瓶子和水的精灵图集\r\n```\r\n\r\n## 主要类说明\r\n\r\n### SpriteConfig_BP\r\n精灵资源配置管理器，根据瓶子容量自动映射对应的精灵图。\r\n\r\n**方法：**\r\n- `getBottleSpriteName(capacity)` - 根据容量获取瓶子精灵名称\r\n- `getWaterSpriteName(capacity)` - 根据容量获取水精灵名称\r\n- `addMapping(capacity, bottleSprite, waterSprite)` - 添加自定义映射\r\n\r\n**容量映射规则：**\r\n```\r\n容量1 → ping1 / shui1，**自动根据容量加载对应的精灵图**。\r\n\r\n**属性：**\r\n- `capacity` - 容量\r\n- `currentAmount` - 当前液体数量\r\n- `targetAmount` - 目标液体数量\r\n- `state` - 当前状态（空闲、选中、倒水、完成）\r\n- `bottleSprite` - 瓶子精灵\r\n- `WaterSprite` - 水精灵（支持fillRange动态显示）\r\n- `spriteAtlas` - 精灵图集引用, atlas)` - 初始化瓶子（自动加载精灵）\r\n- `addWater(amount)` - 添加液体\r\n- `removeWater(amount)` - 移除液体\r\n- `isCompleted()` - 检查是否完成目标\r\n- `clear()` - 清空瓶子\r\n\r\n### BottleMgr_BP\r\n瓶子管理器，处理瓶子的创建、倒水逻辑和关卡检测。\r\n\r\n**新增属性：**\r\n- `bottleSpriteAtlas` - 瓶子和水的精灵图集（需在编辑器中配置）\r\n**方法：**\r\n- `init()` - 初始化所有关卡配置\r\n- `getLevelConfig(levelId)` - 获取指定关卡的配置\r\n- `getBottleCount(levelId)` - 获取该关卡的瓶子数量\r\n- `getDifficulty(levelId)` - 获取难度等级\r\n\r\n### Bottle_BP\r\n代表单个瓶子的类，管理瓶子的液体、状态和目标。\r\n\r\n**属性：**\r\n- `capacity` - 容量\r\n- `currentAmount` - 当前液体数量\r\n- `targetAmount` - 目标液体数量\r\n- `state` - 当前状态（空闲、选中、倒水、完成）\r\n\r\n**方法：**\r\n- `init(id, capacity, targetAmount)` - 初始化瓶子\r\n- `addWater(amount)` - 添加液体\r\n- `removeWater(amount)` - 移除液体\r\n- `isCompleted()` - 检查是否完成目标\r\n- `clear()` - 清空瓶子\r\n\r\n### BottleMgr_BP\r\n瓶子管理器，处理瓶子的创建、倒水逻辑和关卡检测。\r\n\r\n**方法：**\r\n- `initLevel(levelId)` - 初始化关卡\r\n- `pourWater(fromBottle, toBottle)` - 执行倒水\r\n- `undo()` - 撤销最后一次操作\r\n- `resetLevel()` - 重置当前关卡\r\n- `checkLevelCompletion()` - 检查是否完成关卡\r\n- `getOperationCount()` - 获取操作次数\r\n- `checkIfHasValidMoves()` - 检查是否有有效的操作\r\n\r\n### GameManager_BP\r\n游戏主管理器，控制游戏流程。\r\n\r\n**方法：**\r\n- `startLevel(levelId)` - 开始指定关卡\r\n- `pauseGame()` - 暂停游戏\r\n- `resumeGame()` - 继续游戏\r\n- `getCurrentLevel()` - 获取当前关卡号\r\n- `getCompletedLevels()` - 获取已完成的关卡数\r\n- `jumpToLevel(levelId)` - 跳到指定关卡（测试用）\r\n\r\n### UIManager_BP\r\nUI管理器，处理面板和提示信息。\r\n\r\n**方法：**\r\n- `showGameOverPanel(completedLevels)` - 显示游戏结束面板\r\n- `show准备精灵资源\r\n将你的瓶子和水精灵图（ping1-10, shui1-10）打包成一个图集：\r\n- 在 `texture/` 文件夹创建 `BottleAtlas` 图集\r\n- 将所有 ping 和 shui 精灵添加到图集中\r\n- 确保精灵名称与配置一致（ping1, ping2, ..., shui1, shui2, ...）\r\n\r\n## 使用方式\r\n\r\n### 步骤 1：准备精灵资源\r\n将你的瓶子和水精灵图（ping1-10, shui1-10）打包成一个图集：\r\n- 在 `texture/` 文件夹创建 `BottleAtlas` 图集\r\n- 将所有 ping 和 shui 精灵添加到图集中\r\n- 确保精灵名称与配置一致\r\n\r\n### 步骤 2：创建数据文件夹\r\n在项目中创建 `assets/SideMode/BottlePuzzle/data/levels/` 文件夹\r\n\r\n### 步骤 3：生成关卡文件\r\n在编辑器脚本中调用：\r\n```typescript\r\nimport { LevelGeneratorTool } from \"./BottlePuzzle/script/config/LevelGeneratorTool\";\r\n\r\n// 生成关卡 1-20\r\nLevelGeneratorTool.generateAndSaveLevels(1, 20);\r\n\r\n// 或生成单个关卡\r\nLevelGeneratorTool.generateSingleLevel(1);\r\n```\r\n\r\n生成过程会：\r\n1. 逐个生成关卡数据\r\n2. 验证每个关卡都有解法（通过 BFS 求解）\r\n3. 保存为 JSON 文件到 `assets/SideMode/BottlePuzzle/data/levels/`\r\n4. 打包时文件随游戏一起发布\r\n\r\n### 步骤 4：创建预制体\r\n需要在 `prefab/` 文件夹下创建 `BottlePrefab.prefab`，节点结构：\r\n```\r\nBottleNode (Bottle_BP脚本)\r\n\r\n├── BottleSprite (cc.Sprite) - 瓶子外观\r\n├── WaterSprite (cc.Sprite) - 水的显示\r\n│   4置 Type: FILLED\r\n│   设置 Fill Type: VERTICAL\r\n│   设置 Fill Start: 0\r\n├── CapacityLabel (cc.Label) - 容量文字\r\n└── TargetLabel (cc.Label) - 目标文字\r\n```\r\n\r\n**重要配置：**\r\n- Bottle_BP 组件中将 `bottleSprite` 和 `WaterSprite` 拖入对应的精灵节点\r\n- WaterSprite 的精灵类型设置为 FILLED，这样可以用 fillRange 控制水位高度\r\n\r\n### 3. 场景设置\r\n在场景中添加以下节点：\r\n- 根节点：添加 `GameManager_BP` 脚本\r\n- `BottleContainer` 节点：存放所有瓶子\r\n- `BottleMgr` 节点：添加 `BottleMgr_BP` 脚本\r\n- UI 节点：显示关卡、操作次数等信息\r\n\r\n### 5. 属性配置\r\n在编辑器中为 BottleMgr_BP 配置：\r\n- 瓶子容器节点 (bottleContainer)\r\n- 瓶子预制体 (bottlePrefab)\r\n- **瓶子精灵图集 (bottleSpriteAtlas)** ← 新增，拖入创建的图集\r\n\r\n在编辑器中为 GameManager_BP 配置：\r\n- BottleMgr 引用leContainer` 节点：存放所有瓶子\r\n- UI 节点：显示关卡、操作次数等信息\r\n\r\n### 3. 属性配置\r\n在编辑器中为 GameManager_BP 和 BottleMgr_BP 配置以下属性：\r\n- 瓶子容器节点\r\n- 瓶子预制体流动效果和倒水动画（使用粒子系统或序列帧）\r\n3. **记录成绩**：保存每个关卡的最少操作次数\r\n4. **难度调整**：根据玩家反馈调整各关卡的容量配置\r\n5. **提示系统**：实现自动求解或提示功能\r\n6. **自定义精灵映射**：使用 `SpriteConfig_BP.addMapping()` 添加更多容量的精灵\r\n\r\n## 精灵资源设计优势\r\n\r\n✅ **自动匹配** - 根据容量自动选择合适的瓶子和水精灵  \r\n✅ **易于扩展** - 添加新的容量只需配置映射即可  \r\n✅ **精灵图集**：确保所有 ping 和 shui 精灵都在同一个图集中\r\n- **精灵命名**：精灵名称必须与 SpriteConfig_BP 中的配置一致\r\n- **液体显示**：WaterSprite 使用 FILLED 类型，fillRange 控制水位（0-1）\r\n- **容量映射**：如需添加容量11+的精灵，使用 `SpriteConfig_BP.addMapping()`\r\n✅ **统一管理** - 所有精灵通过图集统一加载，性能优化  \r\n✅ **动态显示** - 水精灵使用 fillRange 实现真实的水位效果\r\n## 关卡生成工作流\r\n\r\n```\r\n开发阶段\r\n  ↓\r\n使用 LevelGeneratorTool 生成关卡文件\r\n  ↓\r\n关卡数据保存到：assets/SideMode/BottlePuzzle/data/levels/level_X.json\r\n  ↓\r\n打包游戏\r\n  ↓\r\n关卡文件随游戏一起发布\r\n  ↓\r\n玩家运行游戏\r\n  ↓\r\n游戏从项目资源加载关卡（无需重新生成）\r\n  ↓\r\n所有玩家使用相同的关卡集合\r\n```\r\n\r\n## 关卡数据文件格式\r\n\r\n每个 `level_X.json` 文件包含：\r\n```json\r\n{\r\n  \"levelId\": 1,\r\n  \"bottleConfigs\": [\r\n    { \"capacity\": 5, \"targetAmount\": 2 },\r\n    { \"capacity\": 4, \"targetAmount\": 3 },\r\n    ...\r\n  ],\r\n  \"initialBottles\": [5, 0, 0, 0, 0],  // 初始液体分配\r\n  \"capacities\": [5, 4, 3, 2, 1],\r\n  \"targets\": [2, 3, 2, 1, 1],\r\n  \"difficulty\": 1,\r\n  \"difficultyType\": \"simple\",\r\n  \"solutionSteps\": 5,  // 最少解法步数\r\n  \"generatedTime\": 1642541234567\r\n}\r\n```\r\n\r\n### 难度等级设置\r\n\r\n| 难度类型 | 关卡范围 | 液体分配方式 | 解法难度 |\r\n|---------|--------|-----------|--------|\r\n| **Simple** | 2-3 | 均衡分配 | 易 |\r\n| **Medium** | 4-7 | 中等不均衡 | 中 |\r\n| **Hard** | 8-15 | 高度不均衡 | 难 |\r\n| **Extreme** | 16+ | 极度不均衡 | 极难 |\r\n\r\n- **Simple**：每个瓶子分配的液体量较均匀\r\n- **Medium**：1-2 个瓶子装大部分液体\r\n- **Hard**：1 个瓶子装 50-70% 的液体，其他瓶子装少量\r\n- **Extreme**：采用非常激进的分配（如 9:3:3），容易产生复杂的解法\r\n\r\n## 游戏规则\r\n\r\n1. **初始状态**：所有液体混合在第一个瓶子中\r\n2. **目标**：每个瓶子中的液体数量等于该瓶子的目标容量\r\n3. **操作**：\r\n   - 点击瓶子选中它（显示蓝色）\r\n   - 再点击另一个瓶子进行倒水\r\n   - 倒水时液体会从源瓶子移到目标瓶子\r\n4. **完成条件**：所有瓶子都达到目标容量时，关卡完成\r\n5. **撤销**：点击撤销按钮可以撤销最后一次操作\r\n6. **重新开始**：点击重新开始按钮可以重置当前关卡\r\n\r\n## 扩展建议\r\n\r\n1. **添加音效**：在 `BottleMgr_BP.pourWater()` 中添加倒水音效\r\n2. **优化动画**：改进液体显示效果和倒水动画\r\n3. **记录成绩**：保存每个关卡的最少操作次数\r\n4. **难度调整**：根据玩家反馈调整各关卡的容量配置\r\n5. **提示系统**：实现自动求解或提示功能\r\n\r\n## 注意事项\r\n\r\n- 目前液体显示是通过改变 Sprite 的 scaleY 来实现的，实际使用中可能需要优化\r\n- 所有液体初始放在第一个瓶子，如果需要其他初始分配方式，修改 `initializeWater()` 方法\r\n- 操作记录限制为50步，可以通过修改 `maxRecords` 变量来调整\r\n"]],0,0,[],[],[]]